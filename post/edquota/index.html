<html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>edquota | Raz1ner</title>
  <link rel="shortcut icon" href="https://dev-coco.github.io/favicon.ico?v=1653770648014">
  <link rel="stylesheet" href="https://dev-coco.github.io/styles/main.css">
  <script src="https://dev-coco.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script data-ad-client="ca-pub-6960947409660270" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body>
  <div class="main">
    <div class="header">
      <div class="nav">
        <div class="logo">
          <a href="https://dev-coco.github.io">
            <img class="avatar" src="https://dev-coco.github.io/images/avatar.png?v=1653770648014" alt="">
          </a>
          <div class="site-title">
            <h1>Raz1ner</h1>
          </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
          <ul>
            <li>
              <a href="/" class="menu">首页</a>
            </li>
            <li>
              <a href="/Featured-Software.html" class="menu">软件</a>
            </li>
            <li>
              <a href="/Online-Tools" class="menu">在线工具</a>
            </li>
            <li>
              <a href="/post/Linux-Command" class="menu">Linux命令</a>
            </li>
            <li>
              <a href="/Excel" class="menu">Excel教程</a>
            </li>
            <li>
              <a href="/post/Terms-and-Privacy" class="menu">隐私与条款</a>
            </li>
          </ul>
        </div>
        <form id="gridea-search-form" action="https://dev-coco.github.io/search/" class="search">
          <input type="search" name="q" class="search-box">
          <span class="search-button">
            <span class="search-icon"></span>
          </span>
        </form>
      </div>
    </div>
    <script>
      document.getElementsByClassName('search-button')[0].addEventListener('click', function () {
        document.getElementById('gridea-search-form').classList.toggle('open');
      })
    </script>

    <div id="main-content" class="post-detail main-container">
      <!-- left -->
      <div id="content" class="main-container-left">
        <article class="post i-card">
        <h2 class="post-title">edquota</h2>
        <div class="post-info">
          <time class="post-time">2022-02-03 / 8 min read</time>
            <a href="https://dev-coco.github.io/tag/linux-command/" class="post-tag i-tag i-tag-other_4">#Linux命令</a>
        </div>
          <div class="post-content">
            <p><a href="https://dev-coco.github.io/Excel/">Excel 教程 </a></p>
<p>用于编辑指定用户或工作组磁盘配额。</p>
<!-- more -->
<h2 id="补充说明">补充说明</h2>
<p>edquota 命令用于编辑指定用户或工作组磁盘配额。edquota 预设会使用 vi 来编辑使用者或群组的 quota 设置。</p>
<h2 id="语法">语法</h2>
<pre><code class="language-Shell">edquota (选项) (参数)
</code></pre>
<h2 id="选项">选项</h2>
<pre><code class="language-Shell">-u：设置用户的 quota，这是预设的参数；
-g：设置群组的 quota；
-p&lt;源用户名称&gt;：将源用户的 quota 设置套用至其他用户或群组；
-t：设置宽限期限。
</code></pre>
<h2 id="参数">参数</h2>
<p>用户：指定要编辑磁盘配额限制的用户名或者工作组。</p>
<h2 id="实例">实例</h2>
<p>配置系统的磁盘配额支持</p>
<p>首先，磁盘配额是区域性的，我们可以决定哪块分区进行磁盘配额，哪块分区不用（自然也就不用配置了）。一般而言，作为一台 web 虚拟主机服务器，<code>/home</code>和<code>/www</code>（或者类似的）是供用户存放资源的分区，所以可以对这两个分区进行磁盘配额。假定我们需要对<code>/home</code>分区实现用户级的限制，而对<code>/www</code>进行每个组的用户配额。</p>
<p>第一步：</p>
<pre><code class="language-Shell">vi /etc/fstab
</code></pre>
<p>找到对应于<code>/home</code>和<code>/www</code>的行，例如：</p>
<pre><code class="language-Shell">/dev/sda5 /home ext2 defaults 1 2
/dev/sda7 /www ext2 defaults 1 2
</code></pre>
<p>在<code>/home</code>里实现用户级的磁盘配额，所以对 sda5 行的挂装选项域做如下修改：</p>
<pre><code class="language-Shell">/dev/sda5 /home ext2 defaults，usrquota 1 2
</code></pre>
<p>注意，是 usrquota 哦。类似的，我们可以如下修改<code>/www</code>行：</p>
<pre><code class="language-Shell">/dev/sda7 /www ext2 defaults，grpquota 1 2
</code></pre>
<p>如编辑根用户</p>
<p>改<code>/etc/fstab</code>文件中</p>
<pre><code class="language-Shell">LABEL=/ / ext2 defaults,usrquota,grpquota 1 1
</code></pre>
<p>说明：<code>/etc/fstab</code>文件的每一行由六个字段组成：</p>
<ul>
<li>
<p>第一个字段：文件系统（分区）的注释（类似卷标）；</p>
</li>
<li>
<p>第二个字段：文件系统的装载点；</p>
</li>
<li>
<p>第三个字段：文件系统类型（磁盘配额只能在 ext2 文件系统上实现）；</p>
</li>
<li>
<p>第四个字段：装载文件系统是使用的选项，如果只想实现基于用户的磁盘配额，就加入 usrquota 关键字，只想实现基于组的磁盘配额，就加入 grpqouta 关键字，如果两者都需要，就全写入，中间可以用逗号分隔。</p>
</li>
<li>
<p>第五个字段：表明该文件系统（分区）是否为只读，如果是 0 就表示只读，1 表示可以读写。</p>
</li>
<li>
<p>第六个字段：表示系统启动执行 fsck 时检查的顺序。</p>
</li>
</ul>
<p>注意：请特别注意这里的拼写，是 usrquota 和 grpquota，不要写成 userquota 和 groupquota。</p>
<p>进入单用户模式，用 quotacheck 生成.user 或.group 文件</p>
<p>quotacheck 你的目录</p>
<pre><code class="language-Shell">example:quotacheck / ; quotacheck /home
</code></pre>
<p>如果单用户模式报错的话 umount 你的设备<code>/dev/hda*</code></p>
<p>再执行就 ok 了，重启动系统，如果一切正常的话，quota 将开始正常工作。</p>
<p>设置用户和组配额的分配量</p>
<p>对磁盘配额的限制一般是从一个用户占用磁盘大小和所有文件的数量两个方面来进行的。在具体操作之前，我们先了解一下磁盘配额的两个基本概念：软限制和硬限制。</p>
<ul>
<li>
<p>软限制：一个用户在文件系统可拥有的最大磁盘空间和最多文件数量，在某个宽限期内可以暂时超过这个限制。</p>
</li>
<li>
<p>硬限制：一个用户可拥有的磁盘空间或文件的绝对数量，绝对不允许超过这个限制。</p>
</li>
</ul>
<p>通过 edquota 直接编辑数据文件：</p>
<p>使用编辑配额命令 edquota 为用户配置定额，在重新启动系统之后，我们假设 lanf 是需要定额的系统帐户，可以使用如下命令来为用户分配磁盘配额：</p>
<pre><code class="language-Shell">edquota -u lanf
</code></pre>
<p>这个命令将启动默认文本编辑器（如 vi 或其他由$EDITOR 环境变量指定的编辑器），其内容如下所示：</p>
<pre><code class="language-Shell">Quotas for user lanf:
/dev/sda5:blocks in use:0,limits(soft = 0,hard = 0)
inodes in use:0,limits(soft = 0,hard = 0)
</code></pre>
<p>这表示 lanf 用户在<code>/dev/sda5</code>分区（该分区已经在 usrquota 的控制之下）中迄今使用了 0 个数据块（以 K 为单位），并且没有设限制（包括软限制 soft 和硬限制 hard），同样，lanf 在这个分区也没有任何文件和目录，并且也没有任何软硬限制。如果，我们想对用户进行磁盘容量的限制的话，只需要修改 blocks 行的 limits 部分就可以了，注意单位使用的是 K。例如要为 lanf 分配 100M 磁盘的软限制，400M 硬限制，可以使用如下的设置：</p>
<pre><code class="language-Shell">Quotas for user lanf:
/dev/sda5:blocks in use:0,limits(soft = 102400,hard = 409800)
inodes in use:0,limits(soft = 0,hard = 0)
</code></pre>
<p>同样的，要对文件目录的数量限制可以相应的修改 inodes 行。我们也可以同时对这两项都作出限制。只需要如下的修改 Quotas for user lanf：</p>
<pre><code class="language-Shell">/dev/sda5:blocks in use:0,limits(soft = 102400,hard = 409800)
inodes in use:0,limits(soft = 12800,hard = 51200)
</code></pre>
<p>这表示除了相应的容量的限制外，还对文件/目录的数量做了 12800 个的软限制和 51200 个的硬限制。在保存了新的配置后，该用户的磁盘使用就不能超过硬限制。如果用户试图超过这个限制，该操作将被取消，然后得到一个错误信息。但是，如果每个用户都要这么麻烦的设置的话，那这种重复的体力劳动实在有点令人不寒而栗，而且也太浪费时间了。幸好 edquota 还有个-p 参数（prototype）可以对已有的用户设置进行拷贝。例如，我们想对 Jack、Tom、Chen 三个用户使用和 lanf 一样的限额配置，可以使用如下的命令：</p>
<pre><code class="language-Shell">edquota -p lanf -u Jack Tom Chen
</code></pre>
<p>这样一来，这三个用户就被赋予了和 lanf 一样的磁盘配额。</p>
<p>对组的配额，除了 edquota 命令中对应<code>-u</code>选项的改为<code>-g</code>选项，例如下面对 webterm1 组的操作：</p>
<pre><code class="language-Shell">edquota -g webterm1
</code></pre>
<p>实际上，以上的限制只是对用户设定的硬限制在起作用。如果需要使软限制也起作用的话，还需要对用户的软限制设定宽限期，缺省的软限制的宽限期是无穷，这可以使用 edquota 命令的<code>-t</code>选项来实现。运行下面的命令：</p>
<pre><code class="language-Shell">edquota -t
</code></pre>
<p>edquota 将打开缺省编辑器显示如下内容：</p>
<pre><code class="language-Shell">time units may be:days,hours,minutes,or seconds
Grace period before enforcing soft limits for users:
/dev/sda5:block grace period:0 days,file grace period:0 days
</code></pre>
<p>可以使用天、小时、分、秒为单位来设定宽限期。例如，在下面这个例子中，磁盘空间限制的宽限期为两天，而文件数量限制的宽限期只有 6 个小时。</p>
<pre><code class="language-Shell">Time units may be:days,hours,minutes,or seconds
Grace period before enforcing soft limits for users:
/dev/sda5:block grace period:2 days,file grace period:6 hours
</code></pre>
<p>通过 setquota 工具加入：</p>
<p>比如加入用户 bye2000 的磁盘配额，执行以下命令：</p>
<pre><code class="language-Shell">setquota –u / 2000 2500 100 110 bye2000
</code></pre>
<p>以下是 setquota 命令用法的简单描述：</p>
<pre><code class="language-Shell">setquota [ -u|-g ] 装载点 软块数 硬块数 软文件数 硬文件数 用户名/组名
</code></pre>
<p>查看用户磁盘使用情况</p>
<p>要查明某一个用户使用了多少磁盘空间，例如 lanf，可以使用如下的命令：</p>
<pre><code class="language-Shell">quota -u lanf
</code></pre>
<p>显示：</p>
<pre><code class="language-Shell">Disk quotas for user lanf(uid 503):
Filesystem blocks quota limit grace file quota limit grace
/dev/sda5 3 102400 409800 1 12800 51200
</code></pre>
<p>同样，可以使用<code>quota -g groupname</code>命令来参看某个组的磁盘使用情况。</p>
<p>注意：</p>
<ul>
<li>
<p>如果该用户没有配置磁盘限额的话，输出显示<code>Disk quotas for user hujm (uid 503): none</code></p>
</li>
<li>
<p>如果不带任何参数运行 quota 的话，查看的是你自己的配额使用情况。</p>
</li>
</ul>

          </div>
        </article>
        <div class="next-post">
          <div class="next">下一篇</div>
          <a href="https://dev-coco.github.io/post/dnf/">
            <h3 class="post-title">dnf</h3>
          </a>
        </div>
        <div id="disqus_thread"></div>
        <div id="gitalk-container"></div>
      </div>
      <!-- middle -->
      <div class="main-container-middle"></div>
      <!-- right -->
      <div id="sidebar" class="main-container-right">
      <!-- toc -->
      <div class="toc-card i-card ">
        <div class="toc-title i-card-title">目录</div>
          <div class="toc-content">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E">补充说明</a></li>
<li><a href="#%E8%AF%AD%E6%B3%95">语法</a></li>
<li><a href="#%E9%80%89%E9%A1%B9">选项</a></li>
<li><a href="#%E5%8F%82%E6%95%B0">参数</a></li>
<li><a href="#%E5%AE%9E%E4%BE%8B">实例</a></li>
</ul>
</li>
</ul>

          </div>
          <script>
            function locateCatelogList() {
              /*获取文章目录集合,可通过:header过滤器*/
              var alis = $('.post-content :header');
              /*获取侧边栏目录列表集合**/
              var sidebar_alis = $('.markdownIt-TOC a');
              /*获取滚动条到顶部的距离*/
              var scroll_height = $(window).scrollTop();
              for (var i = 0; i < alis.length; i++) {
                /*获取锚点集合中的元素分别到顶点的距离*/
                var a_height = $(alis[i]).offset().top;
                if (a_height < scroll_height) {
                  /*高亮显示*/
                  sidebar_alis.removeClass('on');
                  $(sidebar_alis[i]).addClass('on');
                }
              }
            }
            $(function() {
              /*绑定滚动事件 */
              $(window).bind('scroll', locateCatelogList);
              });
          </script>
        </div>
      <div class="notice-card i-card ">
        <div class="notice-title i-card-title">公告</div>
        <div class="notice-content">博客新增搜索文章功能。<br>输入关键词后按回车键即可。</div>
      </div>
      <div class="notice-card i-card "><div class="notice-title i-card-title"><a href="/tags/">标签</a></div>
        <div class="notice-content">
          <a class="tags-tag i-tag i-tag-success" href="https://dev-coco.github.io/tag/other/">其它</a>
          <a class="tags-tag i-tag i-tag-error" href="https://dev-coco.github.io/tag/macos/">macOS</a>
          <a class="tags-tag i-tag i-tag-other_4" href="https://dev-coco.github.io/tag/google-script/">Google 脚本</a>
          <a class="tags-tag i-tag i-tag-banana" href="https://dev-coco.github.io/tag/excel/">Excel</a>
          <a class="tags-tag i-tag i-tag-info" href="https://dev-coco.github.io/tag/facebook/">Facebook</a>
          <a class="tags-tag i-tag i-tag-other_1" href="https://dev-coco.github.io/tag/software/">软件</a>
          <a class="tags-tag i-tag i-tag-primary" href="https://dev-coco.github.io/tag/windows/">Windows</a>
          <a class="tags-tag i-tag i-tag-other_4" href="https://dev-coco.github.io/tag/ios/">iOS</a>
          <a class="tags-tag i-tag i-tag-banana" href="https://dev-coco.github.io/tag/shell/">Shell</a>
          <a class="tags-tag i-tag i-tag-other_4" href="https://dev-coco.github.io/tag/whatsapp/">WhatsApp</a>
          <a class="tags-tag i-tag i-tag-" href="https://dev-coco.github.io/tag/linux-command/">Linux命令</a>
        </div>
      </div>
      </div>
    </div>
    <div class="site-footer">
    <img style="vertical-align:middle;" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdev-coco.github.io&count_bg=%2310C1F9&title_bg=%23555555&icon=html5.svg&icon_color=%23E7E7E7&title=%E8%AE%BF%E9%97%AE%E4%BA%BA%E6%95%B0&edge_flat=false"> | <span>Copyright © 2020-2022 Raz1ner - All Rights Reserved.</span> | <a class="rss" href="https://dev-coco.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
  <script>
    $('#sidebar').stickySidebar({
    topSpacing: 80,
    // bottomSpacing: 60
    });
  </script>
  
</body>
</html>