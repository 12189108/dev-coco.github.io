<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>sysctl | Raz1ner</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://dev-coco.github.io/favicon.ico?v=1676058158733">
<link rel="stylesheet" href="https://dev-coco.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="时动态地修改内核的运行参数。

补充说明
sysctl 命令被用于在内核运行时动态地修改内核的运行参数，可用的内核参数在目录/proc/sys中。它包含一些 TCP/ip 堆栈和虚拟内存系统的高级选项， 这可以让有经验的管理员提高引人注目的..." />
    <meta name="keywords" content="Linux命令" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://dev-coco.github.io">
        <img src="https://dev-coco.github.io/images/avatar.png?v=1676058158733" class="site-logo">
        <h1 class="site-title">Raz1ner</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/Featured-Software.html" class="site-nav">
            软件
          </a>
        
      
        
          <a href="/Online-Tools" class="site-nav">
            在线工具
          </a>
        
      
        
          <a href="/post/Linux-Command" class="site-nav">
            Linux命令
          </a>
        
      
        
          <a href="/Excel" class="site-nav">
            Excel教程
          </a>
        
      
        
          <a href="/post/Terms-and-Privacy" class="site-nav">
            隐私与条款
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/dev-coco" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      
    </div>
    <div class="site-footer">
      <span>Copyright © 2020-2023 Raz1ner - All Rights Reserved.</span> | <a class="rss" href="https://dev-coco.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">sysctl</h2>
            <div class="post-date">2022-02-02</div>
            
              <div class="feature-container" style="background-image: url('https://dev-coco.github.io/post-images/Linux-Command.png')">
              </div>
            
            <div class="post-content" v-pre>
              <p>时动态地修改内核的运行参数。</p>
<!-- more -->
<h2 id="补充说明">补充说明</h2>
<p>sysctl 命令被用于在内核运行时动态地修改内核的运行参数，可用的内核参数在目录<code>/proc/sys</code>中。它包含一些 TCP/ip 堆栈和虚拟内存系统的高级选项， 这可以让有经验的管理员提高引人注目的系统性能。用 sysctl 可以读取设置超过五百个系统变量。</p>
<h2 id="语法">语法</h2>
<pre><code class="language-Shell">sysctl (选项) (参数)
</code></pre>
<h2 id="选项">选项</h2>
<pre><code class="language-Shell">-n：打印值时不打印关键字；
-e：忽略未知关键字错误；
-N：仅打印名称；
-w：当改变 sysctl 设置时使用此项；
-p：从配置文件“/etc/sysctl.conf”加载内核参数设置；
-a：打印当前所有可用的内核参数变量和值；
-A：以表格方式打印当前所有可用的内核参数变量和值。
</code></pre>
<h2 id="参数">参数</h2>
<p>变量=值：设置内核参数对应的变量值。</p>
<h2 id="实例">实例</h2>
<p>查看所有可读变量：</p>
<p>sysctl -a</p>
<p>读一个指定的变量，例如<code>kern.maxproc</code>：</p>
<p>sysctl kern.maxproc kern.maxproc: 1044</p>
<p>要设置一个指定的变量，直接用<code>variable=value</code>这样的语法：</p>
<pre><code class="language-Shell">sysctl kern.maxfiles=5000
kern.maxfiles: 2088 -&gt; 5000
</code></pre>
<p>您可以使用 sysctl 修改系统变量，也可以通过编辑 sysctl.conf 文件来修改系统变量。sysctl.conf 看起来很像 rc.conf。它用<code>variable=value</code>的形式来设定值。指定的值在系统进入多用户模式之后被设定。并不是所有的变量都可以在这个模式下设定。</p>
<p>sysctl 变量的设置通常是字符串、数字或者布尔型。（布尔型用 1 来表示 'yes'，用 0 来表示 'no'）。</p>
<pre><code class="language-Shell">sysctl -w kernel.sysrq=0
sysctl -w kernel.core_uses_pid=1
sysctl -w net.ipv4.conf.default.accept_redirects=0
sysctl -w net.ipv4.conf.default.accept_source_route=0
sysctl -w net.ipv4.conf.default.rp_filter=1
sysctl -w net.ipv4.tcp_syncookies=1
sysctl -w net.ipv4.tcp_max_syn_backlog=2048
sysctl -w net.ipv4.tcp_fin_timeout=30
sysctl -w net.ipv4.tcp_synack_retries=2
sysctl -w net.ipv4.tcp_keepalive_time=3600
sysctl -w net.ipv4.tcp_window_scaling=1
sysctl -w net.ipv4.tcp_sack=1
</code></pre>
<h3 id="配置-sysctl">配置 sysctl</h3>
<p>编辑此文件：<code>/etc/sysctl.conf</code></p>
<p>如果该文件为空，则输入以下内容，否则请根据情况自己做调整：</p>
<pre><code class="language-Shell"># Controls source route verification
# Default should work for all interfaces
net.ipv4.conf.default.rp_filter = 1
# net.ipv4.conf.all.rp_filter = 1
# net.ipv4.conf.lo.rp_filter = 1
# net.ipv4.conf.eth0.rp_filter = 1

# Disables IP source routing
# Default should work for all interfaces
net.ipv4.conf.default.accept_source_route = 0
# net.ipv4.conf.all.accept_source_route = 0
# net.ipv4.conf.lo.accept_source_route = 0
# net.ipv4.conf.eth0.accept_source_route = 0

# Controls the System Request debugging functionality of the kernel
kernel.sysrq = 0

# Controls whether core dumps will append the PID to the core filename.
# Useful for debugging multi-threaded applications.
kernel.core_uses_pid = 1

# Increase maximum amount of memory allocated to shm
# Only uncomment if needed!
# kernel.shmmax = 67108864

# Disable ICMP Redirect Acceptance
# Default should work for all interfaces
net.ipv4.conf.default.accept_redirects = 0
# net.ipv4.conf.all.accept_redirects = 0
# net.ipv4.conf.lo.accept_redirects = 0
# net.ipv4.conf.eth0.accept_redirects = 0

# enable Log Spoofed Packets, Source Routed Packets, Redirect Packets
# Default should work for all interfaces
net.ipv4.conf.default.log_martians = 1
# net.ipv4.conf.all.log_martians = 1
# net.ipv4.conf.lo.log_martians = 1
# net.ipv4.conf.eth0.log_martians = 1

# Decrease the time default value for tcp_fin_timeout connection
net.ipv4.tcp_fin_timeout = 25

# Decrease the time default value for tcp_keepalive_time connection
net.ipv4.tcp_keepalive_time = 1200

# Turn on the tcp_window_scaling
net.ipv4.tcp_window_scaling = 1

# Turn on the tcp_sack
net.ipv4.tcp_sack = 1

# tcp_fack should be on because of sack
net.ipv4.tcp_fack = 1

# Turn on the tcp_timestamps
net.ipv4.tcp_timestamps = 1

# Enable TCP SYN Cookie Protection
net.ipv4.tcp_syncookies = 1

# Enable ignoring broadcasts request
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Enable bad error message Protection
net.ipv4.icmp_ignore_bogus_error_responses = 1

# make more local ports available
# net.ipv4.ip_local_port_range = 1024 65000

# set TCP Re-Ordering value in kernel to ‘5′
net.ipv4.tcp_reordering = 5

# Lower syn retry rates
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_syn_retries = 3

# Set Max SYN Backlog to ‘2048′
net.ipv4.tcp_max_syn_backlog = 2048

# Various Settings
net.core.netdev_max_backlog = 1024

# Increase the maximum number of skb-heads to be cached
net.core.hot_list_length = 256

# Increase the tcp-time-wait buckets pool size
net.ipv4.tcp_max_tw_buckets = 360000

# This will increase the amount of memory available for socket input/output queues
net.core.rmem_default = 65535
net.core.rmem_max = 8388608
net.ipv4.tcp_rmem = 4096 87380 8388608
net.core.wmem_default = 65535
net.core.wmem_max = 8388608
net.ipv4.tcp_wmem = 4096 65535 8388608
net.ipv4.tcp_mem = 8388608 8388608 8388608
net.core.optmem_max = 40960
</code></pre>
<p>如果希望屏蔽别人 ping 你的主机，则加入以下代码：</p>
<pre><code class="language-Shell"># Disable ping requests
net.ipv4.icmp_echo_ignore_all = 1
</code></pre>
<p>编辑完成后，请执行以下命令使变动立即生效：</p>
<pre><code class="language-Shell">/sbin/sysctl -p
/sbin/sysctl -w net.ipv4.route.flush=1
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://dev-coco.github.io/tag/linux-command/" class="tag">
                    Linux命令
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://dev-coco.github.io/post/slabtop/">
                  <h3 class="post-title">
                    slabtop
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
