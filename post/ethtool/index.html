<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>ethtool | Dev-Coco</title>

<link rel="shortcut icon" href="https://dev-coco.github.io/favicon.ico?v=1649561576908">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://dev-coco.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Dev-Coco
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Featured-Software.html" class="menu gt-a-link">
                    软件
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Online-Tools" class="menu gt-a-link">
                    在线工具
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Linux-Command" class="menu gt-a-link">
                    Linux命令
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Excel" class="menu gt-a-link">
                    Excel教程
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Terms-and-Privacy" class="menu gt-a-link">
                    隐私与条款
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1649561576908"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    ethtool
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-02-03 ·
                    </time>
                    
                        <a href="https://dev-coco.github.io/tag/linux-command/" class="post-tags">
                            # Linux命令
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>显示或修改以太网卡的配置信息。</p>
<!-- more -->
<h2 id="补充说明">补充说明</h2>
<p>ethtool 命令用于获取以太网卡的配置信息，或者修改这些配置。这个命令比较复杂，功能特别多。</p>
<h2 id="语法">语法</h2>
<pre><code class="language-Shell">ethtool [ -a | -c | -g | -i | -d | -k | -r | -S |] ethX
ethtool [-A] ethX [autoneg on|off] [rx on|off] [tx on|off]
ethtool [-C] ethX [adaptive-rx on|off] [adaptive-tx on|off] [rx-usecs N] [rx-frames N] [rx-usecs-irq N] [rx-frames-irq N] [tx-usecs N] [tx-frames N] [tx-usecs-irq N] [tx-frames-irq N] [stats-block-usecs N][pkt-rate-low N][rx-usecs-low N] [rx-frames-low N] [tx-usecs-low N] [tx-frames-lowN] [pkt-rate-high N] [rx-usecs-high N] [rx-frames-high N] [tx-usecs-high N] [tx-frames-high N] [sample-interval N]
ethtool [-G] ethX [rx N] [rx-mini N] [rx-jumbo N] [tx N]
ethtool [-e] ethX [raw on|off] [offset N] [length N]
ethtool [-E] ethX [magic N] [offset N] [value N]
ethtool [-K] ethX [rx on|off] [tx on|off] [sg on|off] [tso on|off]
ethtool [-p] ethX [N]
ethtool [-t] ethX [offline|online]
ethtool [-s] ethX [speed 10|100|1000] [duplex half|full] [autoneg on|off] [port tp|aui|bnc|mii] [phyad N] [xcvr internal|external]
[wol p|u|m|b|a|g|s|d...] [sopass xx:yy:zz:aa:bb:cc] [msglvl N]
</code></pre>
<h2 id="选项">选项</h2>
<pre><code class="language-Shell">-a 查看网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。
-A 修改网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。
-c display the Coalesce information of the specified ethernet card。
-C Change the Coalesce setting of the specified ethernet card。
-g Display the rx/tx ring parameter information of the specified ethernet card。
-G change the rx/tx ring setting of the specified ethernet card。
-i 显示网卡驱动的信息，如驱动的名称、版本等。
-d 显示register dump信息, 部分网卡驱动不支持该选项。
-e 显示EEPROM dump信息，部分网卡驱动不支持该选项。
-E 修改网卡EEPROM byte。
-k 显示网卡Offload参数的状态：on 或 off，包括rx-checksumming、tx-checksumming等。
-K 修改网卡Offload参数的状态。
-p 用于区别不同ethX对应网卡的物理位置，常用的方法是使网卡port上的led不断的闪；N指示了网卡闪的持续时间，以秒为单位。
-r 如果auto-negotiation模块的状态为on，则restarts auto-negotiation。
-S 显示NIC- and driver-specific 的统计参数，如网卡接收/发送的字节数、接收/发送的广播包个数等。
-t 让网卡执行自我检测，有两种模式：offline or online。
-s 修改网卡的部分配置，包括网卡速度、单工/全双工模式、mac地址等。
</code></pre>
<h3 id="数据来源">数据来源</h3>
<p>Ethtool 命令显示的信息来源于网卡驱动层，即 TCP/ip 协议的链路层。该命令在 Linux 内核中实现的逻辑层次为：<br>
最重要的结构体<code>struct ethtool_ops</code>，该结构体成员为用于显示或修改以太网卡配置的一系列函数指针，见下表中的第二列。<br>
网卡驱动负责实现（部分）这些函数，并将其封装入<code>ethtool_ops</code>结构体，为网络核心层提供统一的调用接口。因此，不同的网卡驱动会给应用层返回不同的信息。<code>Ethtool 命令选项</code>、<code>struct ethtool_ops 成员函数</code>、<code>Ethtool 命令显示参数的来源</code>，三者间的对应关系如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:center">命令选项</th>
<th style="text-align:center">struct ethtool_ops成员函数</th>
<th style="text-align:center">Ethtool命令显示参数的来源（以网卡驱动BNX2为例）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">无 -s</td>
<td style="text-align:center">get_settingsget_wol get_msglevel get_link set_settings set_wol set_msglevel</td>
<td style="text-align:center">从网卡寄存器中获得网卡速度等信息，可配置。</td>
</tr>
<tr>
<td style="text-align:center">-a -A</td>
<td style="text-align:center">get_pauseparam set_pauseparam</td>
<td style="text-align:center">从网卡寄存器中获得Autonegotiate/RX/TX模块的状态：on oroff，可配置。</td>
</tr>
<tr>
<td style="text-align:center">-c -C</td>
<td style="text-align:center">get_coalesceset_coalesce</td>
<td style="text-align:center">从网卡寄存器中获得coalescing参数：TX/RX一个数据包后，推迟发生TX/RX中断的时间(us)/数据包个数。—减小该值可以提高网卡的响应时间。 当rx-usecs&amp;rx-frames同时被设为0时，RX中断停止。 当tx-usecs&amp;tx-frames同时被设为0时，TX中断停止。</td>
</tr>
<tr>
<td style="text-align:center">-g -G</td>
<td style="text-align:center">get_ringparam set_ringparam</td>
<td style="text-align:center">除当前TX/RX ring的值（从网卡寄存器中读取得到，可配置）外，其它为网卡bnx2自己固定的信息。</td>
</tr>
<tr>
<td style="text-align:center">-k -K</td>
<td style="text-align:center">get_rx_csumget_tx_csum get_sg get_tso set_rx_csum set_tx_csum set_sg set_tso</td>
<td style="text-align:center">显示信息从保存该状态的变量中读取得到，没有对应的寄存器。因此，TX/RX校验等模块一直处于on状态，实际上是无法修改的。</td>
</tr>
<tr>
<td style="text-align:center">-i</td>
<td style="text-align:center">get_drvinfo[self_test_count, get_stats_coun,t get_regs_len, get_eeprom_len]</td>
<td style="text-align:center">网卡bnx2自己固定的信息，如： ——————————————————– driver: bnx2 version: 1.4.30 firmware-version: 1.8.0.5 bus-info: 0000:09:00.0 ——————————————————–</td>
</tr>
<tr>
<td style="text-align:center">-d</td>
<td style="text-align:center">get_drvinfoget_regs</td>
<td style="text-align:center">不支持，即bnx2中没有实现函数get_regs。</td>
</tr>
<tr>
<td style="text-align:center">-e -E</td>
<td style="text-align:center">get_eepromset_eeprom</td>
<td style="text-align:center">不支持，即bnx2中没有实现函数get_eeprom。</td>
</tr>
<tr>
<td style="text-align:center">-r</td>
<td style="text-align:center">nway_reset</td>
<td style="text-align:center">配置网卡MII_BMCR寄存器，重启Auto negotiation模块。</td>
</tr>
<tr>
<td style="text-align:center">-p</td>
<td style="text-align:center">phys_id</td>
<td style="text-align:center">配置网卡BNX2_EMAC_LED寄存器，实现LED闪功能。</td>
</tr>
<tr>
<td style="text-align:center">-t</td>
<td style="text-align:center">self_test</td>
<td style="text-align:center">通过配置网卡寄存器，逐一测试网卡的硬件模块：registers，memory，loopback，Link stat，interrupt。</td>
</tr>
<tr>
<td style="text-align:center">-S</td>
<td style="text-align:center">get_ethtool_stats</td>
<td style="text-align:center">显示信息来源于网卡驱动中的结构体变量stats_blk。（网卡通过DMA方式，将寄存器BNX2_HC_STATISTICS _ADDR_L和BNX2_HC_STATISTICS_ADDR_H中的数据实时地读取到结构体变量struct statistics_block *stats_blk中。） —显示的数据都是从网卡寄存器中统计得到的，各项的含义需查询网卡（芯片）手册。</td>
</tr>
</tbody>
</table>
<p>由上可见，ethtool 命令用于显示/配置网卡硬件（寄存器）。</p>
<h2 id="实例">实例</h2>
<p>查看机器上网卡的速度：百兆还是千兆，请输入：</p>
<pre><code class="language-Shell">ethool eth0
</code></pre>
<p>操作完毕后，输出信息中<code>Speed:</code>这一项就指示了网卡的速度。停止网卡的发送模块 TX，请输入：</p>
<pre><code class="language-Shell">ethtool -A tx off eth0
</code></pre>
<p>操作完毕后，可输入<code>ethtool -a eth0</code>，查看 tx 模块是否已被停止。查看网卡 eth0 采用了何种驱动，请输入：</p>
<pre><code class="language-Shell">ethtool -i eth0
</code></pre>
<p>操作完毕后，显示 driver: bnx2；<br>
version: 1.4.30 等信息。关闭网卡对收到的数据包的校验功能，请输入：</p>
<pre><code class="language-Shell">ethtool -K eth0 rx off
</code></pre>
<p>操作完毕后，可输入<code>ethtool –k eth0</code>，查看校验功能是否已被停止。如果机器上安装了两块网卡，那么 eth0 对应着哪块网卡呢？输入：</p>
<pre><code class="language-Shell">ethtool -p eth0 10
</code></pre>
<p>操作完毕后，看哪块网卡的 led 灯在闪，eth0 就对应着哪块网卡。查看网卡，在接收/发送数据时，有没有出错？请输入：</p>
<pre><code class="language-Shell">ethtool –S eth0
</code></pre>
<p>将千兆网卡的速度降为百兆，请输入：</p>
<pre><code class="language-Shell">ethtool -s eth0 speed 100
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://dev-coco.github.io/post/ip6tables/" class="post-title gt-a-link">
                    ip6tables
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">ttest</div>
    <div class="social-container">
        
            
                <a href="https://github.com/dev-coco" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        <span>Copyright © 2020-2022 Dev-Coco - All Rights Reserved.</span>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://dev-coco.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
