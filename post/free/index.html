<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>free | Dev-Coco</title>

<link rel="shortcut icon" href="https://dev-coco.github.io/favicon.ico?v=1649561576908">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://dev-coco.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Dev-Coco
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Featured-Software.html" class="menu gt-a-link">
                    软件
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Online-Tools" class="menu gt-a-link">
                    在线工具
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Linux-Command" class="menu gt-a-link">
                    Linux命令
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Excel" class="menu gt-a-link">
                    Excel教程
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Terms-and-Privacy" class="menu gt-a-link">
                    隐私与条款
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1649561576908"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    free
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-02-03 ·
                    </time>
                    
                        <a href="https://dev-coco.github.io/tag/linux-command/" class="post-tags">
                            # Linux命令
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>显示内存的使用情况。</p>
<!-- more -->
<h2 id="补充说明">补充说明</h2>
<p>free 命令可以显示当前系统未使用的和已使用的内存数目，还可以显示被内核使用的内存缓冲区。</p>
<h2 id="语法">语法</h2>
<pre><code class="language-Shell">free (选项)
</code></pre>
<h2 id="选项">选项</h2>
<pre><code class="language-Shell">-b # 以 Byte 为单位显示内存使用情况；
-k # 以 KB 为单位显示内存使用情况；
-m # 以 MB 为单位显示内存使用情况；
-g # 以 GB 为单位显示内存使用情况。 
-o # 不显示缓冲区调节列；
-s&lt;间隔秒数&gt; # 持续观察内存使用状况；
-t # 显示内存总和列；
-V # 显示版本信息。
</code></pre>
<h2 id="实例">实例</h2>
<pre><code class="language-Shell">free -t    # 以总和的形式显示内存的使用信息
free -s 10 # 周期性的查询内存使用信息，每 10s 执行一次命令
</code></pre>
<p>显示内存使用情况</p>
<pre><code class="language-Shell">free -m
             total       used       free     shared    buffers     cached
Mem:          2016       1973         42          0        163       1497
-/+ buffers/cache:        312       1703
Swap:         4094          0       4094
</code></pre>
<p>第一部分 Mem 行解释：</p>
<pre><code class="language-Shell">total：内存总数；
used：已经使用的内存数；
free：空闲的内存数；
shared：当前已经废弃不用；
buffers Buffer：缓存内存数；
cached Page：缓存内存数。
</code></pre>
<p>关系：total = used + free</p>
<p>第二部分 (-/+ buffers/cache) 解释:</p>
<pre><code class="language-Shell">(-buffers/cache) used 内存数：第一部分 Mem 行中的 used – buffers – cached
(+buffers/cache) free 内存数: 第一部分 Mem 行中的 free + buffers + cached
</code></pre>
<p>可见-buffers/cache 反映的是被程序实实在在吃掉的内存，而+buffers/cache 反映的是可以挪用的内存总数。</p>
<p>第三部分是指交换分区。</p>
<p>输出结果的第四行是交换分区 SWAP 的，也就是我们通常所说的虚拟内存。<br>
区别：第二行 (mem) 的 used/free 与第三行 (-/+ buffers/cache) used/free 的区别。 这两个的区别在于使用的角度来看，第一行是从 OS 的角度来看，因为对于 OS，buffers/cached 都是属于被使用，所以他的可用内存是 2098428KB,已用内存是 30841684KB,其中包括，内核（OS）使用+Application(X, oracle,etc) 使用的+buffers+cached.</p>
<p>第三行所指的是从应用程序角度来看，对于应用程序来说，buffers/cached 是等于可用的，因为 buffer/cached 是为了提高文件读取的性能，当应用程序需在用到内存的时候，buffer/cached 会很快地被回收。</p>
<p>所以从应用程序的角度来说，可用内存=系统 free memory+buffers+cached。<br>
如本机情况的可用内存为：</p>
<p>18007156=2098428KB+4545340KB+11363424KB</p>
<p>接下来解释什么时候内存会被交换，以及按什么方交换。</p>
<p>当可用内存少于额定值的时候，就会开会进行交换。如何看额定值：</p>
<pre><code class="language-Shell">cat /proc/meminfo

MemTotal:       16140816 kB
MemFree:          816004 kB
MemAvailable:    2913824 kB
Buffers:           17912 kB
Cached:          2239076 kB
SwapCached:            0 kB
Active:         12774804 kB
Inactive:        1594328 kB
Active(anon):   12085544 kB
Inactive(anon):    94572 kB
Active(file):     689260 kB
Inactive(file):  1499756 kB
Unevictable:      116888 kB
Mlocked:          116888 kB
SwapTotal:       8191996 kB
SwapFree:        8191996 kB
Dirty:                56 kB
Writeback:             0 kB
AnonPages:      12229228 kB
Mapped:           117136 kB
Shmem:             58736 kB
Slab:             395568 kB
SReclaimable:     246700 kB
SUnreclaim:       148868 kB
KernelStack:       30496 kB
PageTables:       165104 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:    16262404 kB
Committed_AS:   27698600 kB
VmallocTotal:   34359738367 kB
VmallocUsed:      311072 kB
VmallocChunk:   34350899200 kB
HardwareCorrupted:     0 kB
AnonHugePages:   3104768 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
DirectMap4k:      225536 kB
DirectMap2M:    13279232 kB
DirectMap1G:     5242880 kB
</code></pre>
<p>交换将通过三个途径来减少系统中使用的物理页面的个数：</p>
<ul>
<li>
<p>减少缓冲与页面 cache 的大小，</p>
</li>
<li>
<p>将系统 V 类型的内存页面交换出去，</p>
</li>
<li>
<p>换出或者丢弃页面。(Application 占用的内存页，也就是物理内存不足）。</p>
</li>
</ul>
<p>事实上，少量地使用 swap 是不是影响到系统性能的。</p>
<p>那 buffers 和 cached 都是缓存，两者有什么区别呢？</p>
<p>为了提高磁盘存取效率, Linux 做了一些精心的设计, 除了对 dentry 进行缓存 (用于 VFS,加速文件路径名到 inode 的转换), 还采取了两种主要 Cache 方式：</p>
<p>Buffer Cache 和 Page Cache。前者针对磁盘块的读写，后者针对文件 inode 的读写。这些 Cache 有效缩短了 I/O 系统调用 (比如 read,write,getdents) 的时间。<br>
磁盘的操作有逻辑级（文件系统）和物理级（磁盘块），这两种 Cache 就是分别缓存逻辑和物理级数据的。</p>
<p>Page cache 实际上是针对文件系统的，是文件的缓存，在文件层面上的数据会缓存到 page cache。文件的逻辑层需要映射到实际的物理磁盘，这种映射关系由文件系统来完成。当 page cache 的数据需要刷新时，page cache 中的数据交给 buffer cache，因为 Buffer Cache 就是缓存磁盘块的。但是这种处理在 2.6 版本的内核之后就变的很简单了，没有真正意义上的 cache 操作。</p>
<p>Buffer cache 是针对磁盘块的缓存，也就是在没有文件系统的情况下，直接对磁盘进行操作的数据会缓存到 buffer cache 中，例如，文件系统的元数据都会缓存到 buffer cache 中。</p>
<p>简单说来，page cache 用来缓存文件数据，buffer cache 用来缓存磁盘数据。在有文件系统的情况下，对文件操作，那么数据会缓存到 page cache，如果直接采用 dd 等工具对磁盘进行读写，那么数据会缓存到 buffer cache。</p>
<p>所以我们看 linux,只要不用 swap 的交换空间,就不用担心自己的内存太少.如果常常 swap 用很多,可能你就要考虑加物理内存了.这也是 linux 看内存是否够用的标准.</p>
<p>如果是应用服务器的话，一般只看第二行，+buffers/cache,即对应用程序来说 free 的内存太少了，也是该考虑优化程序或加内存了。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://dev-coco.github.io/post/parted/" class="post-title gt-a-link">
                    parted
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">ttest</div>
    <div class="social-container">
        
            
                <a href="https://github.com/dev-coco" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        <span>Copyright © 2020-2022 Dev-Coco - All Rights Reserved.</span>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://dev-coco.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
