<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>tcpreplay | Dev-Coco</title>

<link rel="shortcut icon" href="https://dev-coco.github.io/favicon.ico?v=1649561576908">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://dev-coco.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Dev-Coco
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Featured-Software.html" class="menu gt-a-link">
                    软件
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Online-Tools" class="menu gt-a-link">
                    在线工具
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Linux-Command" class="menu gt-a-link">
                    Linux命令
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/Excel" class="menu gt-a-link">
                    Excel教程
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/Terms-and-Privacy" class="menu gt-a-link">
                    隐私与条款
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1649561576908"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    tcpreplay
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-02-03 ·
                    </time>
                    
                        <a href="https://dev-coco.github.io/tag/linux-command/" class="post-tags">
                            # Linux命令
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>将 PCAP 包重新发送，用于性能或者功能测试。</p>
<!-- more -->
<h2 id="补充说明">补充说明</h2>
<p>简单的说， tcpreplay 是一种 pcap 包的重放工具，它可以将用 ethreal、wireshark 工具抓下来的包原样或经过任意修改后重放回去。它允许你对报文做任意的修改（主要是指对 2 层、3 层、4 层报文头），指定重放报文的速度等，这样 tcpreplay 就可以用来复现抓包的情景以定位 bug，以极快的速度重放从而实现压力测试。</p>
<h2 id="选项">选项</h2>
<pre><code class="language-Shell">-A &quot;&lt;args&gt;&quot; 在使用 tcpdump 风格打印输出信息时，同时再调用 tcpdump 中的参数， 默认已经带有“-n,-l”，所以一般看到的都是 ip 地址，而没有主机名的打印，注意这个是在 tcpreplay 使用了-v 参数时才能使用，不带-v 不会报错，但是没有实际意义。格式：-vA “nnt”表示以 tcpdump 风格输出报文信息，并且不打印时间戳、主机名、端口服务名称。注意不要使用-c 参数来指定打印的数据报文的个数，这样发送出去的报文也会变少。
-c &lt;cachefile&gt; 双网卡回放报文必选参数，后面紧跟 cache 文件名，该文件为 tcpprep 根据对应的 pcap 文件构造出来。
-D 把应用层的数据，使用 dump mode 写入到指定文件中去，和-w、-W 参数一起使用。
-e &lt;ip1:ip2&gt; 指定端点的 ip，即把发送报文的和接收的报文的 ip 都修改称对应的参数值中指定的 ip，但是这样发送的出的报文不会区分 client 和 server。。
-f &lt;configfile&gt; 指定配置文件。
-F 在发送报文时，自动纠正错误的校验和。对测试 DUT 的校验和检验。
-h 显示帮助文件。
-i &lt;nic&gt; 双网卡回放报文必选参数，指定主接口。
-I &lt;mac&gt; 重写主网卡发送出报文的目的 MAC 地址。
-j &lt;nic&gt; 双网卡回放报文必选参数，指定从接口。
-J &lt;mac&gt; 重写从网卡发送出报文的目的 MAC 地址。
-k &lt;mac&gt; 重写主网卡发送报文的源 MAC 地址。
-K &lt;mac&gt; 重写从网卡发送报文的源 MAC 地址。
-l &lt;loop&gt; 指定循环的次数。
-L &lt;limit&gt; 指定最大的发包数量。可以在确认连接的调试时使用。
-m &lt;multiple&gt; 指定一个倍数值，就是必默认发送速率要快多少倍的速率发送报文。 加大发送的速率后，对于 DUT 可能意味着有更多的并发连接和连接数，特别是对于 BT 报文的重放， 因为连接的超时是固定的，如果速率增大的话， 留在 session 表中的连接数量增大，还可以通过修改连接的超时时间来达到该目的。
-M 表示不发送“火星”的 ip 报文，man 文件中的定义是 0/8、172/8、 255/8。
-n 在使用-S 参数，不对混杂模式进行侦听。
-N &lt;CIDR1:CIDR2,...&gt; 通过伪造的 NAT，重写 IP 地址。这个参数应该有很重要的应用，目前没有测试使用。
-O 没有测试使用。
-p &lt;packetrate&gt; 指定每秒发送报文的个数，指定该参数，其它速率相关的参数被忽略，最后的打印信息不会有速率和每秒发送报文的统计。
-P 表示在输出信息中打印 PID 的信息，用于单用户或单帐户模式下暂停和重启程序。
-r &lt;rate&gt; 指定发送的速率。目前-m/-r/-p 这 3 个参数的相互关系。
-R 让网卡极限速度发数据包。
-t &lt;mtu&gt; 指定 MTU，标准的 10/100M 网卡的默认值是 1500。
-T Truncate packets &gt; 截去报文中 MTU 大于标准值的部分再发送出去，默认是不发送，skip 掉。
-v 每发送一个报文都以 tcpdump 的风格打印出对应的信息。
-V 查看版本号。
-w &lt;file&gt; 将主网卡发送的报文写入一个文件中，参数后紧跟文件名。
</code></pre>
<h2 id="实例">实例</h2>
<p>*<em>1、重放在客户端 ftp 连接的报文 *</em></p>
<p>a、在客户端使用 ethereal 抓包，存为 ftp.pcap 文件。</p>
<p>b、 将 ftp.pcap 文件进行 tcpprep 操作，制作 cache 文件。</p>
<pre><code class="language-Shell">[root@A ~]# tcpprep -an client -i ftp.pcap -o ftp.cache –v 
</code></pre>
<p>c、 将 DUT 设备的两个接口和 PC 的两个接口使用网线连接，使用 tcpreplay 重 放报文。注意防火墙的配置为网桥（透明）模式。</p>
<pre><code class="language-Shell">[root@A ~]# tcpreplay -c ftp.cache -i eth0 -j eth1 ftp.pcap -R –v 
</code></pre>
<p>-R 参数表示全速发送，-v 显示打印信息。</p>
<p>*<em>2、重放在客户端 BT 连接的报文 *</em></p>
<p>a、在实验室 BT 下载一些台湾的娱乐节目和热门的大片，使用 ethereal 抓包， 存为 bt.pcap 文件。注意 pcap 文件大小的控制，对 pc 的内存要求比较高，我保 存了一个 600 多 M 的 pcap 文件用了 40 多分钟，大家有需要可以直接从实验室 copy。</p>
<p>b、将 bt.pcap 文件进行 tcpprep 操作，制作 cache 文件。</p>
<pre><code class="language-Shell"> [root@A ~]# tcpprep -an client -i bt.pcap -o bt.cache -C &quot;100M BT Packet&quot; –v
</code></pre>
<p>制作 cache 文件，在 cache 文件中写入“100M BT Packet”的注释。</p>
<p>c、使用 tcpreplay 重放报文。</p>
<pre><code class="language-Shell">[root@A ~]# tcpreplay -c bt.cache -i eth0 -j eth1 bt.pcap -v –R 
</code></pre>
<p>*<em>3、重放 tftp 服务器上抓到的报文 *</em></p>
<p>a、在 tftp 服务器上使用 ethereal 抓包，存为 tftp.pcap 文件。</p>
<p>b、将 pcap 文件进行 tcpprep 的操作，制作 cache 文件。</p>
<pre><code class="language-Shell">[root@A ~]# tcpprep -an server -i tftp.pcap -o tftp.cache –v 
</code></pre>
<p>注意：我在测试的时候犯了一个错误，使用 DUT 的 tftp 升级来做实验，同时穿 过 DUT 重放报文，结果在网卡发送报文的后，DUT 的 mac 地址做了的回应，导致 交互过程没有穿过 DUT，这个问题比较搞笑，上午弄了半天才发现原因，开始还 以为 udp 的连接不能重放。</p>
<p>c、使用 tcpreplay 重放报文。</p>
<pre><code class="language-Shell">[root@A ~]# tcpreplay -c tftp.cache -i eth0 -j eth1 tftp.pcap –v
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://dev-coco.github.io/post/xargs/" class="post-title gt-a-link">
                    xargs
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">ttest</div>
    <div class="social-container">
        
            
                <a href="https://github.com/dev-coco" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        <span>Copyright © 2020-2022 Dev-Coco - All Rights Reserved.</span>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://dev-coco.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
